{
    "builders": [
        {
            "name": "development",
            "type": "docker",
            "image": "fedora:20",
            "commit": true
        },
        {
            "name": "production",
            "type": "openstack",
            "image_name": "sam-baserock-openid-test",
            "flavor": 2,
            "source_image": "752b66d3-8f39-4b52-831e-f638ff3c61f8",
            "networks": ["798c5c38-1983-4fd1-823b-3d32bf78f781"],
            "floating_ip": "85.199.252.126",
            "use_floating_ip": true
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "inline": [ "sleep 10" ],
            "only": ["production"]
        },
        {
            "type": "file",
            "source": "baserock_openid_provider",
            "destination": "/srv",
            "only": ["production"]
        },
        {
            "type": "shell",
            "inline": [ "sudo yum install -y ansible libselinux-python"]
        },
        {
            "type": "ansible-local",
            "playbook_file": "baserock_openid_provider/local.yml"
        },
        {
            "type": "shell",
            "inline": [
                "ln -s /srv/test_baserock_infrastructure/baserock_openid_provider /srv"
            ],
            "only": ["development"]
        },
        {
            "type": "shell",
            "inline": [
                "sudo yum install libselinux-python",
                "sudo ansible localhost -m selinux -a state=disabled",
                "sudo setenforce 0",
                "sudo systemctl enable cherokee",
                "sudo systemctl start cherokee"
            ],
            "only": ["production"]
        }
    ],
    "post-processors": [
        [
            {
                "type": "docker-tag",
                "repository": "baserock/openid-provider",
                "tag": "latest",
                "only": ["development"]
            }
        ]
    ]
}
